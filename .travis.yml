language: php

install: travis_retry composer update --prefer-dist $DEPENDENCIES

script: vendor/bin/phpunit

php: 7.4

jobs:
  include:
    - stage: Test
      php: 7.3
      env: DEPENDENCIES="--prefer-lowest --prefer-stable"

    - stage: Test
      script: vendor/bin/phpstan analyse --level=1 --no-progress src/ tests/
      env: WHAT="phpstan"

    - stage: Test
      script: vendor/bin/psalm --shepherd --stats
      env: WHAT="psalm"

    - stage: Test
      script: vendor/bin/phpmd src/ text phpmd.xml
      env: WHAT="phpmd"

    - stage: Test
      script:
        - composer validate --no-interaction
        - vendor/bin/covers-validator
        - vendor/bin/phpcs -p -s
      env: WHAT="phpcs"

cache:
  directories:
    - $HOME/.composer/cache
